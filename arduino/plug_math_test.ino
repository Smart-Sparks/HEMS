#define BAUDRATE 115200

float Iarray[140] = {17.38,  17.76, 17.95, 18.7,  19.26, 19.64, 19.82, 20.01, 20.38, 20.38, 20.38, 20.57, 20.57, 20.57, 20.38, 20.38, 20.01, 19.82, 19.64, 19.26, 18.89, 18.51, 17.95, 17.38, 16.45, 16.07, 15.14, 14.57, 14.2,  13.45, 12.7,  12.14, 11.57, 11.01, 10.63, 10.26, 9.7, 8.76,  7.64,  6.51,  6.13,  5.57,  4.26,  3.32,  2.2, 1.26, 0.32,  -0.43, -1.37, -2.49, -3.43, -4.37, -5.3,  -6.24, -6.99, -7.74, -8.3,  -9.05, -9.62, -9.8,  -10.55,  -11.3, -12.62,  -12.99,  -13.37,  -14.11,  -15.05,  -15.43,  -15.99,  -16.37,  -16.93,  -17.3, -17.86,  -18.24,  -18.43,  -18.8, -18.99,  -19.18,  -19.37,  -19.37,  -19.55,  -19.55,  -19.55,  -19.74,  -19.55,  -19.37,  -19.37,  -18.8, -18.43,  -18.05,  -17.68,  -17.12,  -16.55,  -15.8, -15.24,  -14.49,  -13.93,  -13.55,  -12.8, -12.05,  -11.49,  -10.55,  -9.99, -9.43, -8.87, -8.87, -7.93, -6.61, -5.68, -5.12, -4.37, -3.24, -2.49, -1.37, -0.43, 0.7, 1.45,  2.2, 3.51,  4.26,  5.2, 6.13,  7.07,  7.82,  8.76,  9.51,  10.07, 10.26, 10.45, 10.45, 11.2,  12.7,  13.26, 13.63, 14.2,  15.14, 15.7,  16.26, 16.82, 17.01};

float Varray[140] = {138.61, 145.91,  150.47,  150.47,  154.12,  157.77,  158.68,  159.59,  159.59,  159.59,  161.41,  161.41,  165.06,  168.71,  165.97,  165.06,  163.24,  189.68,  159.59,  196.98,  155.94,  155.03,  152.29,  145.91,  146.82,  141.35,  135.88,  126.76,  120.38,  113.08,  107.61,  101.23, 99.4,  88.46, 80.25, 72.95, 64.75, 57.45, 50.16, 43.77, 36.48, 31.01, 23.71, 19.15, 11.86, 7.3, 3.65,  -2.74, -14.59,  -23.71,  -28.27,  -33.74,  -42.86,  -51.07,  -57.45,  -67.48,  -76.6, -84.81,  -92.11,  -99.4, -105.78, -113.08, -120.38, -125.85, -129.5,  -134.97, -138.61, -141.35, -145,  -143.17, -145,  -145,  -153.21, -154.12, -156.85, -160.5,  -160.5,  -162.32, -166.88, -165.06, -165.06, -165.06, -165.97, -166.88, -162.32, -164.15, -160.5,  -164.15, -134.05, -157.77, -153.21, -151.38, -146.82, -138.61, -144.09, -134.05, -134.97, -134.97, -128.58, -122.2,  -117.64, -107.61, -101.23, -93.93,  -84.81,  -76.6, -68.4, -60.19,  -54.72,  -41.04,  -41.04,  -34.65,  -26.45  -22.8 -16.41  -13.68  -4.56, 3.65,  15.5,  20.06, 25.53, 32.83, 41.95, 50.16, 57.45, 65.66, 74.78, 81.16, 89.37, 96.67, 103.96,  110.34,  117.64,  122.2, 126.76,  130.41,  133.14,  136.79, 136.79,  136.79};

 

float Vrm = 0.00;
float Vrms = 0.00;
float Irm = 0.00;
float Irms = 0.00;
float S = 0.00;
float pf = 0.00;
float Power = 0.00;
float RealP = 0.00;

float Vr[140];
float Ir[140];
float P[140];


int i = 0;

void setup() {
  // put your setup code here, to run once:
 Serial.begin(115200);   
}

void loop() {
  // put your main code here, to run repeatedly:

for (i; i<139; i++){
 Vr[i] = Varray[i]*Varray[i];        // Computing Vrms - sum(Vsample^2)
 Vrm += Vr[i];   

 Ir[i] = Iarray[i]*Iarray[i];        // Computing Irms  - sum(Isample^2)
 Irm += Ir[i];                

 P[i] = Varray[i] * Iarray[i];       // Computing real power - sum(V*I)
 Power += P[i];     
}
 Vrms = sqrt(Vrm/(i+1));                   // Computing Vrms
           
 Irms = sqrt(Irm/(i+1));                   // Computing Irms
  
 RealP = Power/(i+1);                      // Computing Average Real Power  --- need to rethink
    
 S = Vrms * Irms;                      // Computing apparent power
    
 pf = RealP/S;                         // Computing power factor 

Serial.print(i);
Serial.print('\t');
Serial.print(Vrms);
Serial.print('\t');
Serial.print(Irms); 
Serial.print('\t'); 
Serial.print(RealP);
Serial.print('\t'); 
Serial.print(S); 
Serial.print('\t'); 
Serial.println(pf);    
}
